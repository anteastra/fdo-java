<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<title>INTUIT.ru::Интернет-Университет Информационных Технологий</title>
<link rel="shortcut icon" href="http://www.intuit.ru/favicon.ico">


<META http-equiv="Pragma" CONTENT="no-cache">
<META http-equiv="Cache-Control" CONTENT="no-cache, must-revalidate">
<META NAME="Pragma" CONTENT="no-cache">
<META NAME="Cache-Control" CONTENT="no-cache">
<link href="../../../ssi/style.css" type="text/css" rel="stylesheet">
</head>
<body leftmargin="0" topmargin="6" marginheight="6" marginwidth="0" bgcolor="white">

<!-- header -->
<!---->
<table border="0" cellpadding="8" cellspacing="0" width="100%">
<tr valign="top">
<td><a href="http://www.intuit.ru/"><img src="../../../img/logo.gif" border="0" width="285" height="52" alt="Интернет Университет информационных технологий"></a></td>
<!---->
</tr>
</table>

<!-- /header -->

<!-- /menu -->
<table border="0" cellpadding="" cellspacing="6" width="100%">
<tr>
<td align="center" class="menu">
	<table border="0" cellpadding="0" cellspacing="0" background="" height="31">
	<tr>
	<td><a href="http://www.intuit.ru/speciality/" class="menu">Учебные программы</a></td>
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/all_departments.html" class="menu">Кафедры</a></td>	
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/all_courses.html" class="menu">Все курсы</a></td>	
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/syllabus.html" class="menu">Расписание</a></td>		
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/shop/" class="menu">Учебники</a></td>		
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/news.html" class="menu">Новости</a></td>		
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/department/forum/" class="menu">Форум</a></td>
<!--
	<td><img src="../../../img/separator.gif" width="2" height="18" border="0" hspace="7"></td>
	<td><a href="http://www.intuit.ru/help/" class="menu">Помощь</a></td>		
-->
	</tr>
	</table>	

</td>
</tr>
</table>
<!-- /menu -->


<table border="0" cellpadding="0" cellspacing="0" width="100%" height="73">
<tr valign="top">
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
<td width="180">
	<!-- leftcolumn -->
	<table border="0" cellpadding="2" cellspacing="0" background="" width="100%">

		<tr valign="middle">
	<td class="orang" height="24">&nbsp;&nbsp;Лекции</td>
	</tr>
	<tr>
	<td>
		<table border="0" cellpadding="0" cellspacing="0">

		<tr valign=top>

		<td colspan=3>
<a href="../index.html" class="spec">Программирование на Java</a>


</td>
		</tr>
<tr valign=top><td colspan="3" height="6"><img src="../../../img/empty.gif" width="1" height="6"></td></tr>

		<tr valign=top>

		<td class="llecture">1.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../1/1.html" class="llecture">Что такое Java? История создания</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">2.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../2/1.html" class="llecture">Основы объектно-ориентированного...</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">3.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../3/1.html" class="llecture">Лексика языка</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">4.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../4/1.html" class="llecture">Типы данных</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">5.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../5/1.html" class="llecture">Имена. Пакеты</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">6.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../6/1.html" class="llecture">Объявление классов</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">7.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../7/1.html" class="llecture">Преобразование типов</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">8.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../8/1.html" class="llecture">Объектная модель в Java</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">9.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../9/1.html" class="llecture">Массивы</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">10.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../10/1.html" class="llecture">Операторы и структура кода. Искл...</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">11.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../11/1.html" class="llecture">Пакет java.awt</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">12.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../12/1.html" class="llecture">Потоки выполнения. Синхронизация</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">13.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../13/1.html" class="llecture">Пакет java.lang</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">14.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../14/1.html" class="llecture">Пакет java.util</a>
</td>
		</tr>




		<tr valign=top>

		<td class="llecture">15.</td>
		<td>&nbsp;</td>
<td class="llecture">


<a href="../15/1.html" class="llecture_selected">Пакет java.io</a>


</td>
		</tr>




		<tr valign=top>

		<td class="llecture">16.</td>
		<td>&nbsp;</td>
<td class="llecture">

<a href="../16/1.html" class="llecture">Введение в сетевые протоколы</a>
</td>
		</tr>






<tr valign=top><td colspan="3" height="6"><img src="../../../img/empty.gif" width="1" height="6"></td></tr>
		<tr valign=top>

		<td class="llecture">&nbsp;</td>
<td>&nbsp;</td>

		<td class="llecture"><a href="http://www.intuit.ru/department/pl/javapl/class/examination/" class="llecture">Экзамен</a></td>
		</tr>
		<tr valign=top>

		<td class="llecture">&nbsp;</td>
<td>&nbsp;</td>

		<td class="llecture"><a class="llecture_red" href="http://www.intuit.ru/department/pl/javapl/class/examination_extern/">Сдать экзамен экстерном</a></td>
		</tr>

<tr valign=top><td colspan="3" height="6"><img src="../../../img/empty.gif" width="1" height="6"></td></tr>

		<tr valign=top>

		<td class="llecture">&nbsp;</td>
<td>&nbsp;</td>

		<td class="llecture"><a href="../lit.html" class="llecture">Литература</a></td>
		</tr>





		<tr valign=top>

		<td class="llecture">&nbsp;</td>
<td>&nbsp;</td>

		<td class="llecture"><a href="../keywords.html" class="llecture">Предметный указатель</a></td>
		</tr>



		<tr valign=top>

		<td class="llecture">&nbsp;</td>
<td>&nbsp;</td>

		<td class="llecture"><a href="../examples.html" class="llecture">Примеры</a></td>
		</tr>


		</table><br>
	</td>
	</tr>


	

	<tr valign="middle">
	<td class="orang" height="24">&nbsp;&nbsp;Общение</td>
	</tr>
	<tr>
	<td>
		<table border="0" cellpadding="0" cellspacing="0">

		<tr valign=top>
		<td><img src="../../../img/arrow.gif" border="0" width="6" height="7" hspace="5" vspace="5"></td>
		<td><a href="http://www.intuit.ru/department/pl/javapl/class/classmates/" class="spec">однокурсники</a></td>
		</tr>
		

		<tr valign=top>
		<td><img src="../../../img/arrow.gif" border="0" width="6" height="7" hspace="5" vspace="5"></td>
		<td><a href="http://www.intuit.ru/department/pl/javapl/forum/" class="spec">форум по курсу</a></td>
		</tr>

		<tr valign=top>
		<td><img src="../../../img/arrow.gif" border="0" width="6" height="7" hspace="5" vspace="5"></td>
		<td><a href="http://www.intuit.ru/department/pl/javapl/class/question_for_lector/" class="spec">вопрос преподавателю</a></td>
		</tr>

		<tr valign=top>
		<td><img src="../../../img/arrow.gif" border="0" width="6" height="7" hspace="5" vspace="5"></td>
		<td><a href="http://www.intuit.ru/department/pl/javapl/class/opinions/" class="spec">мнения о курсе</a></td>
		</tr>

		<tr valign=top>
		<td><img src="../../../img/arrow.gif" border="0" width="6" height="7" hspace="5" vspace="5"></td>
		<td><a href="http://www.intuit.ru/department/pl/javapl/class/rating/" class="spec">рейтинг выпускников</a></td>
		</tr>


		</table><br>
	</td>
	</tr>



<tr><td height="1"><a href="../robot.html"><img src="../../../img/empty.gif" width="1" height="1" border="0"></a></td></tr>

	</table>

	<!-- #include virtual="~/inc/leftcolumn.html" -->
	<!-- /leftcolumn -->	
</td>
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
<td width="1" class="gray"><img src="../../../img/empty.gif"></td>
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
<td>
	<!-- content -->
	<table border="0" cellpadding="0" cellspacing="0" width="100%">
	<tr><td class="head" colspan=2>Программирование на Java</td></tr>
<tr><td colspan=2 height="4"><img src="../../../img/empty.gif" width="1" height="4"></td></tr>
	<tr><td class="orang" height="1" colspan=2><img src="../../../img/empty.gif" width="1" height="1"></td></tr>
	<tr><td height="8" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>




<tr>
<td colspan="2" align=left class="headsub">Лекция #15: <a href="../15/1.html">Пакет java.io</a></td>
</tr>

<tr><td height="6" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>
<tr><td class="orang" height="1" colspan=2><img src="../../../img/empty.gif" width="1" height="1"></td></tr>
<tr><td height="2" colspan=2><img src="../../../img/empty.gif" width="1" height="2"></td></tr>


<tr>

<td align=left><font class="rtitle">Страницы:</font>
<a class="rtitle" href="2.html">&laquo;</a> <font class="stitle">|</font>


<a class="rtitle" href="1.html">1</a>
<font class="stitle">|</font>


<a class="rtitle" href="2.html">2</a>
<font class="stitle">|</font>

<font class="rtitle">3</font>

<font class="stitle">|</font>


<a class="rtitle" href="4.html">4</a>
<font class="stitle">|</font>


<a class="rtitle" href="http://www.intuit.ru/department/pl/javapl/15/test/">вопросы</a> <font class="stitle">|</font> 
<a class="rtitle" href="4.html"><b>&raquo;</b></a>
</td>
<td align=right><font class="stitle">|</font>
<a href="http://www.intuit.ru/department/pl/javapl/15/javapl_15.html" class="rtitle" target="_blank">HTML для печати</a>




</td>

</tr>


	<tr><td height="2" colspan=2><img src="../../../img/empty.gif" width="1" height="2"></td></tr>
<tr><td align="center" class="orang_light" colspan="2">
&nbsp;
<font class="rtxt">Если Вы заметили ошибку на этой странице - <a class="llecture_red" target="_blank" href="http://www.intuit.ru/help/askform.xhtml?course=57&url=http://www.intuit.ru/department/pl/javapl/15/3.html">сообщите нам.</a></font>
&nbsp;
</td></tr>

	<tr><td height="8" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>
	<tr><td colspan=2>


    
    <h3 >Сериализация объектов (serialization)</h3>
        
        <p ><a name="keyword-context.3"></a>
		Для объектов процесс преобразования в последовательность байт и обратно организован несколько сложнее – объекты имеют различную структуру, хранят ссылки на другие объекты и т.д. Поэтому такая процедура получила специальное название - <span class="keyword">сериализация</span> (serialization), обратное действие, – то есть воссоздание объекта из последовательности байт – десериализация. </p>
        <p >Поскольку сериализованный объект – это последовательность байт, которую можно легко сохранить в файл, передать по сети и т.д., то и объект затем можно восстановить на любой машине, вне зависимости от того, где проводилась <span class="keyword">сериализация</span>. Разумеется, Java позволяет не задумываться при этом о таких факторах, как, например, используемая операционная система на машине-отправителе и получателе. Такая гибкость обусловила широкое применение <span class="keyword">сериализации</span> при создании распределенных приложений, в том числе и корпоративных (enterprise) систем. </p>
        <h4 >Стандартная сериализация</h4>
            
            <p >Для представления объектов в виде последовательности байт определены унаследованные от <span class="texample">DataInput</span> и <span class="texample">DataOutput</span> интерфейсы <span class="texample">ObjectInput</span> и <span class="texample">ObjectOutput</span>, соответственно. В java.io имеются реализации этих интерфейсов – классы <span class="texample">ObjectInputStream</span> и <span class="texample">ObjectOutputStream</span>. </p>
            <p >Эти классы используют стандартный механизм <span class="keyword">сериализации</span>, который предлагает JVM. Для того, чтобы объект мог быть сериализован, класс, от которого он порожден, должен реализовывать интерфейс <span class="texample">java.io.Serializable</span>. В этом интерфейсе не определен ни один метод. Он нужен лишь для указания, что объекты класса могут участвовать в <span class="keyword">сериализации</span>. При попытке сериализовать объект, не имеющий такого интерфейса, будет брошен <span class="texample">java.io.NotSerializableException</span>. </p>
            <p >Чтобы начать <span class="keyword">сериализацию</span> объекта, нужен выходной <span class="keyword">поток</span>
                <span class="texample">OutputStream</span>, в который и будет записываться сгенерированная последовательность байт. Этот <span class="keyword">поток</span> передается в конструктор <span class="texample">ObjectOutputStream</span>. Затем вызовом метода <span class="texample">writeObject()</span> объект сериализуется и записывается в выходной <span class="keyword">поток</span>. Например: </p>
            <div  class="example"><pre>
ByteArrayOutputStream os = 
   new ByteArrayOutputStream();
Object objSave = new Integer(1);
ObjectOutputStream oos = 
   new ObjectOutputStream(os);
oos.writeObject(objSave);
</pre></div>
            <p >Чтобы увидеть, во что превратился объект <span class="texample">objSave</span>, можно просмотреть содержимое массива: </p>
            <div  class="example"><pre>
byte[] bArray = os.toByteArray(); 
</pre></div>
            <p >А чтобы восстановить объект, его нужно десериализовать из этого массива: </p>
            <div  class="example"><pre>
ByteArrayInputStream is = 
   new ByteArrayInputStream(bArray);
ObjectInputStream ois = 
   new ObjectInputStream(is);
Object objRead = ois.readObject();
</pre></div>
            <p >Теперь можно убедиться, что восстановленный объект идентичен исходному: </p>
            <div  class="example"><pre>
System.out.println("readed object is: " + 
                    objRead.toString());
System.out.println("Object equality is: " + 
   (objSave.equals(objRead)));
System.out.println("Reference equality is: " +
                   (objSave==objRead)); 
</pre></div>
            <p >Результатом выполнения приведенного выше кода будет: </p>
            <div  class="example"><pre>
readed object is: 1
Object equality is: true
Reference equality is: false 
</pre></div>
            <p >Как мы видим, восстановленный объект не совпадает с исходным (что очевидно – ведь восстановление могло происходить и на другой машине), но равен сериализованному по значению. </p>
            <p >Как обычно, для упрощения в примере была опущена обработка ошибок. Однако, <span class="keyword">сериализация</span> (десериализация) объектов довольно сложная процедура, поэтому возникающие сложности не всегда очевидны. Рассмотрим основные исключения, которые может генерировать метод <span class="texample">readObject()</span> класса <span class="texample">ObjectInputStream</span>. </p>
            <p >Предположим, объект некоторого класса <span class="texample">TestClass</span> был сериализован и передан по сети на другую машину для восстановления. Может случиться так, что у считывающей JVM на локальном диске не окажется описания этого класса (файл <span class="texample">TestClass.class</span>). Поскольку стандартный механизм <span class="keyword">сериализации</span> записывает в <span class="keyword">поток</span> байт лишь состояние объекта, для успешной десериализации необходимо наличие описание класса. В результате будет брошено исключение <span class="texample">ClassNotFoundException</span>. </p>
            <p >Причина появления <span class="texample">java.io.StreamCorruptedException</span> вполне очевидна из названия – неправильный формат входного <span class="keyword">потока</span>. Предположим, происходит попытка считать сериализованный объект из файла. Если этот файл испорчен (для эксперимента можно открыть его в текстовом редакторе и исправить несколько символов), то стандартная процедура десериализации даст сбой. Эта же ошибка возникнет, если считать некоторое количество байт (с помощью метода <span class="texample">read</span>) непосредственно из надстраиваемого <span class="keyword">потока</span>
                <span class="texample">InputStream</span>. В таком случае <span class="texample">ObjectInputStream</span> снова обнаружит сбой в формате данных и будет брошено исключение <span class="texample">java.io.StreamCorruptedException</span>. </p>
            <p >Поскольку <span class="texample">ObjectOutput</span> наследуется от <span class="texample">DataOutput</span>, <span class="texample">ObjectOutputStream</span> может быть использован для последовательной записи нескольких значений как объектных, так и примитивных типов в произвольной последовательности. Если при считывании будет вызван метод <span class="texample">readObject</span>, а в исходном <span class="keyword">потоке</span> следующим на очереди записано значение примитивного типа, будет брошено исключение <span class="texample">java.io.OptionalDataException</span>. Очевидно, что для корректного восстановления данных из <span class="keyword">потока</span> их нужно считывать именно в том порядке, в каком были записаны. </p>
        
        <h4 >Восстановление состояния</h4>
            
            <p >Итак, <span class="keyword">сериализация</span> объекта заключается в сохранении и восстановлении состояния объекта. В Java в большинстве случаев состояние описывается значениями полей объекта. Причем, что важно, не только тех полей, которые были явно объявлены в классе, от которого порожден объект, но и унаследованных полей. </p>
            <p >Предположим, мы бы попытались своими силами реализовать стандартный механизм <span class="keyword">сериализации</span>. Нам передается выходной <span class="keyword">поток</span>, в который нужно записать состояние нашего объекта. С помощью <span class="texample">DataOutput</span> интерфейса можно легко сохранить значения всех доступных полей (будем для простоты считать, что они все примитивного типа). Однако в большинстве случаев в родительских классах могут быть объявлены недоступные нам поля (например, <span class="texample">private</span>). Тем не менее, такие поля, как правило, играют важную роль в определении состояния объекта, так как они могут влиять на результат работы унаследованных методов. Как же сохранить их значения? </p>
            <p >С другой стороны, не меньшей проблемой является восстановление объекта. Как говорилось раньше, объект может быть создан только вызовом его конструктора. У класса, от которого порожден десериализуемый объект, может быть несколько конструкторов, причем, некоторые из них, или все, могут иметь аргументы. Какой из них вызвать? Какие значения передать в качестве аргументов? </p>
            <p >После создания объекта необходимо установить считанные значения его полей. Однако многие классы имеют специальные <span class="texample">set</span>-методы для этой цели. В таких методах могут происходить проверки, могут меняться значения вспомогательных полей. Пользоваться ли этими методами? Если их несколько, то как выбрать правильный и какие параметры ему передать? Снова возникает проблема работы с недоступными полями, полученными по наследству. Как же в стандартном механизме <span class="keyword">сериализации</span> решены все эти вопросы? </p>
            <p >Во-первых, рассмотрим подробнее работу с интерфейсом <span class="texample">Serializable</span>. Заметим, что класс <span class="texample">Object</span> не реализует этот интерфейс. Таким образом, существует два варианта – либо сериализуемый класс наследуется от <span class="texample">Serializable</span>-класса, либо нет. Первый вариант довольно прост. Если родительский класс уже реализовал интерфейс <span class="texample">Serializable</span>, то наследникам это свойство передается автоматически, то есть все объекты, порожденные от такого класса, или любого его наследника, могут быть сериализованы. </p>
            <p >Если же наш класс впервые реализует <span class="texample">Serializable</span> в своей ветке наследования, то его суперкласс должен отвечать специальному требованию – у него должен быть доступный конструктор без параметров. Именно с помощью этого конструктора будет создан десериализуемый объект и будут проинициализированы все поля, унаследованные от классов, не наследующих <span class="texample">Serializable</span>. </p>
            <p >Рассмотрим пример: </p>
            <a  name="example.15.10"></a><div  class="example"><span class="objectName">
            Пример 
            15.10.
            
            (<a href="example.15.10.htm" target="_blank" onClick="window.open('example.15.10.htm','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">html</a>,
            <a href="example.15.10.txt" target="_blank" onClick="window.open('example.15.10.txt','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">txt</a>)
            </span></div>
            <p >В этом примере объявлено 3 класса. Класс <span class="texample">Parent</span> не реализует <span class="texample">Serializable</span> и, следовательно, не может быть сериализован. В нем объявлено 2 поля, которые при создании получают значения, содержащие слово <span class="texample">"old"</span> ("старый"). Кроме этого, объявлен метод, позволяющий модифицировать эти поля. Он выставляет им значения, содержащие слово <span class="texample">"new"</span> ("новый’). Также переопределен метод <span class="texample">toString()</span>, чтобы дать возможность узнать значения этих полей. </p>
            <p >Поскольку класс <span class="texample">Parent</span> имеет доступный конструктор по умолчанию, его наследник может реализовать интерфейс <span class="texample">Serializable</span>. Обратите внимание, что у самого класса <span class="texample">Child</span> такого конструктора уже нет. Также объявлено поле и модифицирован метод <span class="texample">toString()</span>. </p>
            <p >Наконец, класс <span class="texample">Child2</span> наследуется от <span class="texample">Child</span>, а потому автоматически является допустимым для <span class="keyword">сериализации</span>. Аналогично, имеет новое поле, значение которого отображает <span class="texample">toString()</span>. </p>
            <p >Запускаемый класс <span class="texample">Test</span> сериализует в файл <span class="texample">output.bin</span> два объекта. Обратите внимание, что у первого из них предварительно вызывается метод <span class="texample">changeNames()</span>, который модифицирует значения полей, унаследованных от класса <span class="texample">Parent</span>. </p>
            <p >Результат выполнения примера: </p>
            <a  name="example.15.11"></a><div  class="example"><span class="objectName">
            Пример 
            15.11.
            
            (<a href="example.15.11.htm" target="_blank" onClick="window.open('example.15.11.htm','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">html</a>,
            <a href="example.15.11.txt" target="_blank" onClick="window.open('example.15.11.txt','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">txt</a>)
            </span></div>
            <p >Во всех конструкторах вставлена строка, выводящая сообщение на консоль. Так можно отследить, какие конструкторы вызываются во время десериализации. Видно, что для объектов, порожденных от <span class="texample">Serializable</span>-классов, конструкторы не вызываются вовсе. Идет обращение лишь к конструктору без параметров не-<span class="texample">Serializable</span>-суперкласса. </p>
            <p >Сравним значения полей первого объекта и его копии, полученной десериализацией. Поля, унаследованные от не-<span class="texample">Serializable</span>-класса (<span class="texample">firstName</span>, <span class="texample">lastName</span>), не восстановились. Они имеют значения, полученные в конструкторе <span class="texample">Parent</span> без параметров. Поля, объявленные в <span class="texample">Serializable</span>-классе, свои значения сохранили. Это верно и для второго объекта – собственные поля <span class="texample">Child2</span> и унаследованные от <span class="texample">Child</span> имеют точно такие же значения, что и до <span class="keyword">сериализации</span>. Их значения были записаны, а потом считаны и напрямую установлены из <span class="keyword">потока данных</span>. </p>
            <p >Иногда в классе есть поля, которые не должны участвовать в <span class="keyword">сериализации</span>. Тому может быть несколько причин. Например, это поле малосущественно (временная переменная) и сохранять его нет необходимости. Если сериализованный объект передается по сети, то исключение такого поля из <span class="keyword">сериализации</span> позволяет уменьшить нагрузку на сеть и ускорить работу приложения. </p>
            <p >Некоторые поля хранят значения, которые не будут иметь смысла при пересылке объекта на другую машину, или при воссоздании его спустя какое-то время. Например, сетевое соединение, или подключение к базе данных, в таких случаях нужно устанавливать заново. </p>
            <p >Затем, в объекте может храниться конфиденциальная информация, например, пароль. Если такое поле будет сериализовано и передано по сети, его значение может быть перехвачено и прочитано, или даже подменено. </p>
            <p >Для исключения поля объекта из <span class="keyword">сериализации</span> его необходимо объявить с модификатором <span class="texample">transient</span>. Например, следующий класс: </p>
            <div  class="example"><pre>
class Account implements 
      java.io.Serializable {
   private String name;
   private String login;
   private transient String password;
   /* объявление других элементов класса
   ...
   */
}
</pre></div>
            <p >У такого класса поле <span class="texample">password</span> в <span class="keyword">сериализации</span> участвовать не будет и при восстановлении оно получит значение по умолчанию (в данном случае <span class="texample">null</span>). </p>
            <p >Особого внимания требуют статические поля. Поскольку они принадлежат классу, а не объекту, они не участвуют в <span class="keyword">сериализации</span>. При восстановлении объект будет работать с таким значением <span class="texample">static</span>-поля, которое уже установлено для его класса в этой JVM. </p>
        
        <h4 >Граф сериализации</h4>
            
            <p >До этого мы рассматривали объекты, которые имеют поля лишь примитивных типов. Если же сериализуемый объект ссылается на другие объекты, их также необходимо сохранить (записать в <span class="keyword">поток</span> байт), а при десериализации – восстановить. Эти объекты, в свою очередь, также могут ссылаться на следующие объекты. При этом важно, что если несколько ссылок указывают на один и тот же объект, то этот объект должен быть сериализован лишь однажды, а при восстановлении все ссылки должны вновь указывать на него одного. Например, сериализуемый объект <span class="texample">A</span> ссылается на объекты <span class="texample">B</span> и <span class="texample">C</span>, каждый из которых, в свою очередь, ссылается на один и тот же объект <span class="texample">D</span>. После деeсериализации не должно возникать ситуации, когда <span class="texample">B</span> ссылается на <span class="texample">D1</span>, а <span class="texample">C</span> – на <span class="texample">D2</span>, где <span class="texample">D1</span> и <span class="texample">D2</span> – равные, но все же различные объекты. </p>
            <p >Для организации такого процесса стандартный механизм <span class="keyword">сериализации</span> строит граф, включающий в себя все участвующие объекты и ссылки между ними. Если очередная ссылка указывает на некоторый объект, сначала проверяется – нет ли такого объекта в графе. Если есть – объект второй раз не сериализуется. Если нет – новый объект добавляется в граф. </p>
            <p >При построении графа может встретиться объект, порожденный от класса, не реализующего интерфейс <span class="texample">Serializable</span>. В этом случае <span class="keyword">сериализация</span> прерывается, генерируется исключение <span class="texample">java.io.NotSerializableException</span>. </p>
            <p >Рассмотрим пример: </p>
            <a  name="example.15.12"></a><div  class="example"><span class="objectName">
            Пример 
            15.12.
            
            (<a href="example.15.12.htm" target="_blank" onClick="window.open('example.15.12.htm','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">html</a>,
            <a href="example.15.12.txt" target="_blank" onClick="window.open('example.15.12.txt','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">txt</a>)
            </span></div>
            <p >В этой программе работа идет с классом <span class="texample">Line</span> (линия), который имеет 2 поля типа <span class="texample">Point</span> (линия описывается двумя точками). Запускаемый класс <span class="texample">Main</span> создает два объекта класса <span class="texample">Line</span>, причем, одна из точек у них общая. Кроме этого, линия имеет номер (поле <span class="texample">index</span>). Созданные линии (номера 1 и 2) записываются в <span class="keyword">поток</span>, после чего одна из них получает новый номер (3) и вновь сериализуется. </p>
            <p >Выполнение этой программы приведет к выводу на экран примерно следующего: </p>
            <a  name="example.15.13"></a><div  class="example"><span class="objectName">
            Пример 
            15.13.
            
            (<a href="example.15.13.htm" target="_blank" onClick="window.open('example.15.13.htm','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">html</a>,
            <a href="example.15.13.txt" target="_blank" onClick="window.open('example.15.13.txt','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">txt</a>)
            </span></div>
            <p >Из примера видно, что после восстановления у линий сохраняется общая точка, описываемая одним и тем же объектом (хеш-код <span class="texample">386e</span>). </p>
            <p >Третий записанный объект идентичен первому, причем, совпадают даже объектные ссылки. Несмотря на то, что при записи третьего объекта значение <span class="texample">index</span> было изменено на 3, в десериализованном объекте оно осталось равным <span class="texample">1</span>. Так произошло потому, что объект, описывающий первую линию, уже был задействован в <span class="keyword">сериализации</span> и, встретившись во второй раз, повторно записан не был. </p>
            <p >Чтобы указать, что сеанс <span class="keyword">сериализации</span> завершен, и получить возможность передавать измененные объекты, у <span class="texample">ObjectOutputStream</span> нужно вызвать метод <span class="texample">reset()</span>. В рассматриваемом примере для этого достаточно убрать комментарий в строке </p>
            <div  class="example"><pre>
//oos.reset(); 
</pre></div>
            <p >Если теперь запустить программу, то можно увидеть, что третий объект получит номер 3. </p>
            <a  name="example.15.14"></a><div  class="example"><span class="objectName">
            Пример 
            15.14.
            
            (<a href="example.15.14.htm" target="_blank" onClick="window.open('example.15.14.htm','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">html</a>,
            <a href="example.15.14.txt" target="_blank" onClick="window.open('example.15.14.txt','','menubar=no,scrollbars=yes,resizable=yes');return false;" class="objectName">txt</a>)
            </span></div>
            <p >Однако это будет уже новый объект, ссылка на который отличается от первой считанной линии. Более того, обе точки будут также описываться новыми объектами. То есть в новом сеансе все объекты были записаны, а затем восстановлены заново. </p>
        
        <h4 >Расширение стандартной сериализации</h4>
            
            <p >Некоторым сложно организованным классам требуется особый подход для <span class="keyword">сериализации</span>. Для расширения стандартного механизма можно объявить в классе два метода с точно такой сигнатурой: </p>
            <div  class="example"><pre>
private void writeObject(
               java.io.ObjectOutputStream out)
   throws IOException;
private void readObject(
               java.io.ObjectInputStream in)
   throws IOException, ClassNotFoundException;
</pre></div>
            <p >Если в классе объявлены такие методы, то при <span class="keyword">сериализации</span> объекта для записи его состояния будет вызван <span class="texample">writeObject</span>, который должен сгенерировать последовательность байт и записать ее в <span class="keyword">поток</span>
                <span class="texample">out</span>, полученный в качестве аргумента. При этом можно вызвать стандартный механизм записи объекта путем вызова метода </p>
            <div  class="example"><pre>
out.defaultWriteObject(); 
</pre></div>
            <p >Этот метод запишет все не-<span class="texample">transient</span> и не-<span class="texample">static</span> поля в <span class="keyword">поток данных</span>. </p>
            <p >В свою очередь, при десериализации метод <span class="texample">readObject</span> должен считать данные из <span class="keyword">потока</span>
                <span class="texample">in</span> (также полученного в качестве аргумента) и восстановить значения полей класса. При реализации этого метода можно обратиться к стандартному механизму с помощью метода: </p>
            <div  class="example"><pre>
in.defaultReadObject(); 
</pre></div>
            <p >Этот метод считывает описание объекта из <span class="keyword">потока</span> и присваивает значения соответствующих полей в текущем объекте. </p>
            <p >Если же процедура <span class="keyword">сериализации</span> в корне отличается от стандартной, то для таких классов предназначен альтернативный интерфейс <span class="texample">java.io.Externalizable</span>. </p>
            <p >При использовании этого интерфейса в <span class="keyword">поток</span> автоматически записывается только идентификация класса. Сохранить и восстановить всю информацию о состоянии экземпляра должен сам класс. Для этого в нем должны быть объявлены методы <span class="texample">writeExternal()</span> и <span class="texample">readExternal()</span> интерфейса <span class="texample">Externalizable</span>. Эти методы должны обеспечить сохранение состояния, описываемого полями самого класса и его суперкласса. </p>
            <p >При восстановлении <span class="texample">Externalizable</span>-объекта экземпляр создается путем вызова конструктора без аргументов, после чего вызывается метод <span class="texample">readExternal</span>. </p>
            <p >Метод <span class="texample">writeExternal</span> имеет сигнатуру: </p>
            <div  class="example"><pre>
void writeExternal(ObjectOutput out) 
   throws IOException; 
</pre></div>
            <p >Для сохранения состояния вызываются методы <span class="texample">ObjectOutput</span>, с помощью которых можно записать как примитивные, так и объектные значения. Для корректной работы в соответствующем методе </p>
            <div  class="example"><pre>
void readExternal(ObjectInput in) 
   throws IOException,ClassNotFoundException;
</pre></div>
            <p >эти значения должны быть считаны в том же самом порядке. </p>
        


    
	</td>		
	</tr>
	<tr><td height="8" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>

	<tr><td height="8" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>
	<tr><td colspan=2 align="center">

<a href="4.html" class="attention">Перейти к следующей странице &raquo;</b></a>

	</td></tr>
	<tr><td height="16" colspan=2><img src="../../../img/empty.gif" width="1" height="16"></td></tr>

<tr><td align="center" class="orang_light" colspan="2">
&nbsp;
<font class="rtxt">Если Вы заметили ошибку на этой странице - <a class="llecture_red" target="_blank" href="http://www.intuit.ru/help/askform.xhtml?course=57&url=http://www.intuit.ru/department/pl/javapl/15/3.html">сообщите нам.</a></font>
&nbsp;
</td></tr>

	<tr><td height="2" colspan=2><img src="../../../img/empty.gif" width="1" height="2"></td></tr>
<tr>

<td align=left><font class="rtitle">Страницы:</font>
<a class="rtitle" href="2.html">&laquo;</a> <font class="stitle">|</font>


<a class="rtitle" href="1.html">1</a>
<font class="stitle">|</font>


<a class="rtitle" href="2.html">2</a>
<font class="stitle">|</font>

<font class="rtitle">3</font>

<font class="stitle">|</font>


<a class="rtitle" href="4.html">4</a>
<font class="stitle">|</font>


<a class="rtitle" href="http://www.intuit.ru/department/pl/javapl/15/test/">вопросы</a> <font class="stitle">|</font> 
<a class="rtitle" href="4.html"><b>&raquo;</b></a>
</td>
<td align=right><font class="stitle">|</font>
<a href="http://www.intuit.ru/department/pl/javapl/15/javapl_15.html" class="rtitle" target="_blank">HTML для печати</a>




</td>

</tr>

	<tr><td height="8" colspan=2><img src="../../../img/empty.gif" width="1" height="8"></td></tr>
	<tr><td class="orang" height="1" colspan=2><img src="../../../img/empty.gif" width="1" height="1"></td></tr>
	</table>
	<!-- /content -->

</td>
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
<td width="1" class="gray"><img src="../../../img/empty.gif"></td>
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
<td width="180">
	<!-- rightcolumn -->
	<table border="0" cellpadding="2" cellspacing="0" background="" width="100%">
	<!---->


<!--Основные понятия-->
	<td class="bordo" height="24">&nbsp;&nbsp;Ключевые слова</td>
	</tr>
	<tr>
	<td><span class="rtxt"><span  class="keyword_list">поток данных</span>, <span  class="keyword_list_def">сериализация</span><br ><br ><a  class="allnews" href="../keywords.html">все ключевые слова »</a>
</td>
	</tr>
	<tr><td>&nbsp;</td></tr>
<!--/Основные понятия-->

		<tr><td class="bordo" height="24">&nbsp;&nbsp;Информация о лекции</td></tr>
	<tr>
	<td>
<span class="rtxt">Эта лекция описывает реализованные в Java возможности передачи информации, что является важной функцией для большинства программных систем. Сюда входит работа с файлами, сетью, долговременное сохранение объектов, обмен данными между потоками исполнения и т.п. Все эти действия базируются на потоках байт (представлены классами InputStream и OutputStream) и потоках символов (Reader и Writer). В библиотеке java.io содержатся все эти классы и их многочисленные наследники, предоставляющие полезные возможности. Отдельно рассматривается механизм сериализации объектов и работа с файлами.

	</td>
	</tr>
	<tr><td>&nbsp;</td></tr>

	

	
	<td class="bordo" height="24">&nbsp;&nbsp;Учебники к курсу</td>
	</tr>
	<tr>
<td>

		<table border="0" cellpadding="0" cellspacing="0">


		<tr valign="top">
		<td>

<table border="0" cellpadding="1" cellspacing="0"  align="left" hspace="5" vspace="2"><tr><td class="orang"><table border="0" cellpadding="2" cellspacing="0" bgcolor="#ffffff"><tr><td valign="middle" align="center"><a href="http://www.intuit.ru/shop/catalog/product.xhtml?id=2459325"><img width="72" height="105" src="../../../img/covers/i/in/int/intu006.jpg" alt="Программирование на Java" border="0"></a></td></tr></table></td></tr></table>

<a href="http://www.intuit.ru/shop/catalog/product.xhtml?id=2459325" class="spectitle">
Программирование на Java</a>
<br>
<font class="spectxt">
Вязовик Н.А.,
<br>
Интернет-университет информационных технологий - ИНТУИТ.ру.
<br>
Курс лекций посвящен современному и мощному языку программирования Java. В его рамках дается вводное изложение принципов ООП, необходимое для разработки на Java, основы языка, библиотеки для работы с файлами, сетью, для построения оконного интерфейса пользователя (GUI) и др.

</font>
		</td>
		</tr>

		</table>

</td>
	</tr>


	<tr><td height="10"><img src="../../../img/empty.gif" width="1" height="10"></td></tr>



	<tr>
<td>
		<table border="0" cellpadding="0" cellspacing="0">


		<tr valign="top">
		<td class="spectxt">
<span class="spectitle"><a href="http://www.intuit.ru/shop/catalog/product.xhtml?id=1412049" class="spectitle">Приемы объектно-ориентированного проектирования. Паттерны проектирования</a></span>
<br>
Гамма Э. и др.,
Питер.
		</td>
		</tr>


		</table>

</td>
	</tr>


<tr>
<td><a href="http://www.intuit.ru/cgi-bin/goto.fcgi?mode=books_of_course&cid=57" class="allnews">все книги по курсу &raquo;</a></td>
</tr>



	</table>
	<!-- /rightcolumn -->
</td>
<td width="6"><img src="../../../img/empty.gif" width="6"></td>
</tr>
</table>

<!-- /bottom -->
<table border="0" cellpadding="0" cellspacing="6" width="100%" height="73">
<tr>
<td align="center" class="menu">
    <table border="0" cellpadding="0" cellspacing="0" background="">
    <tr>
    <td class="copy">
    <a href="http://www.intuit.ru/all_departments.html" class="bot">Кафедры</a> |
    <a href="http://www.intuit.ru/all_courses.html" class="bot">Все курсы</a> |
    <a href="http://www.intuit.ru/syllabus.html" class="bot">Расписание</a> |
    <a href="http://www.intuit.ru/shop/catalog/index.html?" class="bot">Учебники</a> | 
    <a href="http://www.intuit.ru/news.html" class="bot">Новости</a> | 
    <a href="http://www.intuit.ru/department/forum/" class="bot">Форум</a>
    <br>
    <a href="http://www.intuit.ru/user/classes/" class="bot">Мои курсы</a> | 
    <a href="http://www.intuit.ru/user/adjustments/" class="bot">Личные настройки</a> | 
    <a href="http://www.intuit.ru/user/cart/" class="bot">Корзина</a> | 
    <a href="http://www.intuit.ru/help/" class="bot">Помощь</a><br><br>
    Телефон: (095) 253-9312, 253-9313, факс: (095) 253-9310, email: <a href="http://www.intuit.ru/help/askform.xhtml" class="bot">info@intuit.ru</a><br>
    Адрес: 123056 Москва, Электрический пер., 8, стр. 3<br>
    &copy; 2003-2004 INTUIT.ru. Все права защищены.
    </td>
    </tr>
    </table>
</td>
</tr>
</table>
<!-- /bottom -->


</body>
</html>
